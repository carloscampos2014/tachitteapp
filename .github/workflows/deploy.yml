name: Deploy Blazor to GitHub Pages

on:
  push:
    branches:
      - master # Altere para o seu branch principal, se necessário

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      # Adicione esta nova etapa para instalar as ferramentas de otimização
      - name: Install Blazor WebAssembly Workload
        run: dotnet workload install wasm-tools

      - name: Restore dependencies
        run: dotnet restore TachittesApp/TachittesApp.csproj

      - name: Publish Blazor WebAssembly
        run: dotnet publish TachittesApp/TachittesApp.csproj -c Release

      - name: Adjust Base Path for GitHub Pages
        run: |
          REPO_NAME=$(echo ${{ github.repository }} | cut -d '/' -f 2)
          sed -i "s/<base href=\"\\/\" \\/>/<base href=\"\\/${REPO_NAME}\\/\" \\/>/g" TachittesApp/bin/Release/net8.0/publish/wwwroot/index.html
          sed -i "s|const base = \"/\";|const base = \"/${REPO_NAME}/\";|g" TachittesApp/bin/Release/net8.0/publish/wwwroot/service-worker.published.js

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: TachittesApp/bin/Release/net8.0/publish/wwwroot